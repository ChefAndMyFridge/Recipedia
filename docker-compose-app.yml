services:
  client:
    container_name: my-react
    environment:
      - APP_URL=${APP_URL}  # ec2 URL
    build:
      context: ./frontend   # client í´ë”ë¥¼ ë¹Œë“œ ì»¨í…ìŠ¤íŠ¸ë¡œ ì§€ì •
      dockerfile: Dockerfile  # í´ë¼ì´ì–¸íŠ¸ìš© Dockerfile ê²½ë¡œ (ë””í´íŠ¸ëŠ” 'Dockerfile')
    ports:
      - "80:80"        # ec2 urlì€ 80ë²ˆ í¬íŠ¸ë§Œ ì—´ë ¤ìˆìŒìŒ
    depends_on:
      - server
    # volumes:
    #   - ./frontend/nginx.conf:/etc/nginx/conf.d/default.conf
    networks:
      - app-network

  server:
    container_name: my-springboot
    environment:
      - MYSQL_ROOT_PASSWORD=${MYSQL_ROOT_PASSWORD}  # .envì—ì„œ ê°€ì ¸ì˜´
    build:
      context: ./backend   # server í´ë”ë¥¼ ë¹Œë“œ ì»¨í…ìŠ¤íŠ¸ë¡œ ì§€ì •
      dockerfile: Dockerfile  # ì„œë²„ìš© Dockerfile ê²½ë¡œ
    ports:
      - "8080:8080"        # ì„œë²„ í¬íŠ¸ ì—°ê²°
    # depends_on:
    #   db:
    #     condition: service_healthy  # ğŸ”¥ MySQLì´ "ì™„ì „íˆ ì¤€ë¹„ë  ë•Œê¹Œì§€" ëŒ€ê¸°
    networks:
      - app-network
  
  fastapi:  # FastAPI ì„œë¹„ìŠ¤ ì¶”ê°€! ğŸš€
    container_name: my-fastapi
    build:
      context: ./ai  # FastAPI ì½”ë“œê°€ ìˆëŠ” í´ë”
      dockerfile: Dockerfile  # FastAPIìš© Dockerfile
    ports:
      - "8000:8000"  # FastAPIëŠ” ê¸°ë³¸ì ìœ¼ë¡œ 8000ë²ˆ í¬íŠ¸ ì‚¬ìš©
    # depends_on:
    #   db:
    #     condition: service_healthy  # MySQLì´ ì™„ì „íˆ ì‹¤í–‰ëœ í›„ ì‹œì‘
    networks:
      - app-network

networks:
  app-network:
    external: true