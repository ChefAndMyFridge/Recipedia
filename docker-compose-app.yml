services:
  # client:
  #   container_name: my-react-${BRANCH_NAME}
  #   environment:
  #     - TZ=Asia/Seoul
  #     - VITE_API_URL=${VITE_API_URL}  # ec2 URL
  #   build:
  #     context: ./frontend   # client í´ë”ë¥¼ ë¹Œë“œ ì»¨í…ìŠ¤íŠ¸ë¡œ ì§€ì •
  #     dockerfile: Dockerfile  # í´ë¼ì´ì–¸íŠ¸ìš© Dockerfile ê²½ë¡œ (ë””í´íŠ¸ëŠ” 'Dockerfile')
  #     args:
  #       BRANCH_NAME: ${BRANCH_NAME}
  #       VITE_API_URL: ${VITE_API_URL}
  #   ports:
  #     - "80:80"        # ec2 urlì€ 80ë²ˆ í¬íŠ¸ë§Œ ì—´ë ¤ìˆìŒ
  #     - "443:443"
  #   depends_on:
  #     - server
  #   volumes:
  #     - /home/ubuntu/front_build:/usr/share/nginx
  #     - /etc/letsencrypt:/etc/letsencrypt:ro
  #   networks:
  #     - app-network

  server:
    container_name: my-springboot-${BRANCH_NAME}
    environment:
      - TZ=Asia/Seoul
      - HOST_URL=${HOST_URL} 
      - MYSQL_ROOT_PASSWORD=${MYSQL_ROOT_PASSWORD}  # .envì—ì„œ ê°€ì ¸ì˜´
      - ELASTIC_PASSWORD=${ELASTIC_PASSWORD}
      - FASTAPI_API_URL=${FASTAPI_API_URL}
    build:
      context: ./backend   # server í´ë”ë¥¼ ë¹Œë“œ ì»¨í…ìŠ¤íŠ¸ë¡œ ì§€ì •
      dockerfile: Dockerfile  # ì„œë²„ìš© Dockerfile ê²½ë¡œ
    ports:
      - "${SPRING_BOOT_PORT}:8080"        # ì„œë²„ í¬íŠ¸ ì—°ê²°
    networks:
      - app-network
  
  fastapi:  # FastAPI ì„œë¹„ìŠ¤ ì¶”ê°€! ğŸš€
    container_name: my-fastapi-${BRANCH_NAME}
    environment:
      - TZ=Asia/Seoul
      - YOUTUBE_API_KEY=${YOUTUBE_API_KEY}
      - YOUTUBE_API_KEYS=${YOUTUBE_API_KEYS}
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - USDA_API_KEY=${USDA_API_KEY}
      - ALLOWED_ORIGINS=${ALLOWED_ORIGINS}
    build:
      context: ./ai  # FastAPI ì½”ë“œê°€ ìˆëŠ” í´ë”
      dockerfile: Dockerfile  # FastAPIìš© Dockerfile
    ports:
      - "${FASTAPI_PORT}:8000"  # FastAPIëŠ” ê¸°ë³¸ì ìœ¼ë¡œ 8000ë²ˆ í¬íŠ¸ ì‚¬ìš©
    networks:
      - app-network

networks:
  app-network:
    external: true